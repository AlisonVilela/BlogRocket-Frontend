##Customize the test machine
machine:
##Version of Node use
  node:
    version: 7.10.0
##Customize dependencies
dependencies:
  override:
    - npm install --silent --loglevel error
##Test override
test:
  override:
    - ./node_modules/@angular/cli/bin/ng lint --type-check
    - ./node_modules/@angular/cli/bin/ng test --watch=false --progress=false
##deployment
deployment:
  production:
    branch: master
    commands:
      - ./node_modules/@angular/cli/bin/ng build -e prod -prod --aot --progress=false
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - git subtree push --prefix dist git@heroku.com:blog-rocket.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake db:migrate --app blog-rocket:
        timeout: 400
